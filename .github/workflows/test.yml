on: push
name: proj ci
jobs:
  proj:
    name: proj
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    strategy:
      matrix:
        features: ["", "network", "bundled_proj", "bundled_proj network"]
    container:
      image: georust/geo-ci:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - run: cargo build --features ${{ matrix.features }}
      - run: cargo test --features ${{ matrix.features }}

  proj-sys:
    name: proj-sys
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    defaults:
      run:
        working-directory: proj-sys
    container: ${{ matrix.container }}
    strategy:
      matrix:
        features: ["", "bundled_proj"]
        container: 
          - image: "georust/geo-ci:latest"
            env: 
              _PROJ_SYS_TEST_EXPECT_BUILD_FROM_SRC: 0
          - image: "georust/geo-ci-without-system-proj:latest"
            env: 
              _PROJ_SYS_TEST_EXPECT_BUILD_FROM_SRC: 1
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - run: cargo build --features ${{ matrix.features }}
      - run: cargo test --features ${{ matrix.features }}
